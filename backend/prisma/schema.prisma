

generator client {
  provider = "prisma-client-js"

}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_NEON_URL")
}


model User {
  id          Int       @id @default(autoincrement())
  username    String    @unique
  email       String    @unique
  passwordHash String
  createdAt   DateTime  @default(now())

  // Relations
  chatParticipants ChatParticipant[]
  messages         Message[]
  messageStatuses  MessageStatus[]
}

model Chat {
  id        Int       @id @default(autoincrement())
  name      String?   // null for 1-1 chats
  isGroup   Boolean   @default(false)
  createdAt DateTime  @default(now())

  // Relations
  participants ChatParticipant[]
  messages     Message[]
}

model ChatParticipant {
  id       Int      @id @default(autoincrement())
  chatId   Int
  userId   Int
  role     String   @default("member") // admin, member
  joinedAt DateTime @default(now())

  // Relations
  chat Chat @relation(fields: [chatId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([chatId, userId])
}

model Message {
  id          Int      @id @default(autoincrement())
  chatId      Int
  senderId    Int?
  content     String?
  messageType String   @default("text") // text, image, file
  createdAt   DateTime @default(now())

  // Relations
  chat   Chat  @relation(fields: [chatId], references: [id], onDelete: Cascade)
  sender User? @relation(fields: [senderId], references: [id], onDelete: SetNull)
  statuses MessageStatus[]
}

model MessageStatus {
  id        Int      @id @default(autoincrement())
  messageId Int
  userId    Int
  status    String   @default("delivered") // sent, delivered, read
  updatedAt DateTime @default(now())

  // Relations
  message Message @relation(fields: [messageId], references: [id], onDelete: Cascade)
  user    User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([messageId, userId])
}